<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Motion GLB</title>
</head>
<script>
    var model = null;
    var nextModel = null;
    var morphProgress = 0;
    var isMorphing = false;
    const modelSwitchInterval = 1000 / 10;
    var currSnap = 1;
    var lastSnap = 500;
</script>

<script type="module">
    import * as THREE from 'https://cdn.jsdelivr.net/gh/mesquite-mocap/mesquite.cc/build-static/three.module.js';
    import { GLTFLoader } from 'https://cdn.jsdelivr.net/gh/mesquite-mocap/mesquite.cc/build-static/GLTFLoader.js';
    import { OrbitControls } from 'https://cdn.jsdelivr.net/gh/mesquite-mocap/mesquite.cc/build-static/OrbitControls.js';
    import Stats from 'https://cdn.jsdelivr.net/gh/mesquite-mocap/mesquite.cc/build-static/stats.module.js';

    const stats = new Stats();
    stats.showPanel(0); // 0: fps, 1: ms, 2: memory
    document.body.appendChild(stats.dom);

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);



    camera.position.z = 5;

    // controls
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true; // an animation effect
    controls.dampingFactor = 0.25;
    controls.enableZoom = true;

    const ambientLight = new THREE.AmbientLight(0x404040); // Soft
    scene.add(ambientLight);

    // 4 spot lights
    const spotLight1 = new THREE.SpotLight(0xffffff, 10);
    spotLight1.position.set(1, 1, 1);
    spotLight1.castShadow = true;
    scene.add(spotLight1);

    const spotLight2 = new THREE.SpotLight(0xffffff, 10);
    spotLight2.position.set(-1, 1, 1);
    spotLight2.castShadow = true;
    scene.add(spotLight2);

    const spotLight3 = new THREE.SpotLight(0xffffff, 10);
    spotLight3.position.set(1, -1, 1);
    spotLight3.castShadow = true;
    scene.add(spotLight3);

    const spotLight4 = new THREE.SpotLight(0xffffff, 10);
    spotLight4.position.set(-1, -1, 1);
    spotLight4.castShadow = true;
    scene.add(spotLight4);

    //directional light on top
    const directionalLight = new THREE.DirectionalLight(0xffffff, 10);
    directionalLight.position.set(0, 1, 0);
    directionalLight.castShadow = true;
    scene.add(directionalLight);

    let lastModelSwitch = 0;

    function animate() {
        requestAnimationFrame(animate);
        
        const currentTime = Date.now();
        
        // Switch models at specified interval
        if (currentTime - lastModelSwitch >= modelSwitchInterval) {
            var folder = String(currSnap).padStart(5, '0');
            var file = `../data/scripts/images/${folder}/output.glb`;
            loadModel(file);
            lastModelSwitch = currentTime;
            if(currSnap < lastSnap) {
                currSnap++;
            } else {
                currSnap = 1;
            }
        }
        
        controls.update();
        renderer.render(scene, camera);
    }

    // Start the animation loop
    animate();

    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }
    window.addEventListener('resize', onWindowResize, false);

    function loadModel(url) {
        const loader = new GLTFLoader();
        loader.load(url, function (gltf) {
            scene.add(gltf.scene);
            gltf.scene.scale.set(4, 4, 4); // Adjust scale as needed
            gltf.scene.position.set(0, 0, 0); // Center the model
            if (model) {
                scene.remove(model);
                stats.update();
            } else {
                stats.begin();
            }
            model = gltf.scene;
        }, undefined, function (error) {
            console.error(error);
        });
    }
</script>

<body style="margin: 0; overflow: hidden; background-color: black;">
</body>

</html>